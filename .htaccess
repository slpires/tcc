# ============================================
# /tcc/public/.htaccess  (DEV e PRD, único)
# ============================================

RewriteEngine On

# 1) Autodetecção de ambiente por Host
SetEnv APP_ENV production
SetEnvIf Host "^localhost(:[0-9]*)?$"        APP_ENV=development
SetEnvIf Host "^127\.0\.0\.1(:[0-9]*)?$"     APP_ENV=development

# 2) Opções
Options -Indexes -MultiViews

# 3) HTTPS apenas em produção
RewriteCond %{ENV:APP_ENV} =production
RewriteCond %{HTTPS} !=on
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# 4) Roteamento (front controller)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ index.php [L]

# 5) Bloqueio a arquivos sensíveis (Apache 2.4+)
<IfModule mod_authz_core.c>
  <FilesMatch "\.(env|ini|log|sql|bak|old|sh|conf|git|gitignore|example)$">
    Require all denied
  </FilesMatch>
</IfModule>

# 6) Variáveis para o app (lidas no PHP)
RewriteCond %{ENV:APP_ENV} =production
RewriteRule .* - [E=APP_DEBUG:false]
RewriteCond %{ENV:APP_ENV} =development
RewriteRule .* - [E=APP_DEBUG:true]
SetEnvIfNoCase . "^.*$" APP_DEBUG=%{ENV:APP_DEBUG}
